#node-static-asset

node-static-asset is *the best* static asset manager for Node.JS, designed for use with Express, Jade,
Stylus, and Browserify. This project aims to solve all application deployment problems. No thinking
required.

## Install

`npm install static-asset`

...and done.

## Basic Usage

Usually, this should be good enough to get started. Stylus, CSS, Jade templates, and client-side
JavaScript are automatically handled for you.

```javascript
var app = require('express').createServer();
var asset = require('static-asset');
asset.useDefaultConfiguration();
asset.deploy();
app.use(asset.middleware);
```

## Default Configuration

By default, static-asset does the following:

* Development Environment
	* When applicable, all files are compiled with debugging information, uncompressed
* Production Environment
	* When applicable, all files are minified and compiled without debugging information
* .css and .styl files are rendered using Stylus
* .jade files are compiled and written to *.js files
* .coffee files are compiled to *.js files
* Assumes the following directory structure for your project:

```
	project/
		/server
			The location of app.js
		/client
			All client-side .js and .coffee files
			/lib
				Client-side libraries
		/views
			.jade and .html files are in here
		/css
			.styl and .css source files are in here
		/public
			All of the content publicly available to the WWW
			/images
				Contains all of your images (png, jpeg, gif, bmp, etc.)
			/assets
				This dir may be generated by static-asset and can be wiped at any time!
			/abcdef
				This directory will never be touched. It's safe to put files in /static
```

## Advanced Usage

```javascript
var app = require('express').createServer();
var asset = require('static-asset');
var stylus = require('stylus');
var jade = require('jade');

asset.configure(function() {
	//Environment-specific configuration goes here... 'this' refers to 'asset'
	
	//CSS
	this.register(['styl', 'css'], function(body, filename, cb) {
		//'this' still refers to 'asset'
		stylus(body, this.get('stylus'))
			.set('filename', filename)
			.set('compress',  || true)
			.include(__dirname + '/../css/')
			.import(__dirname + '/../css/mixins.styl')
			.import(__dirname + '/../css/colors.styl')
			.render(cb);
	});
	//Error-handling
	this.on('error', function(err) {
		//Do something about some error
		console.log('This asset is being an ' + "asset".substring(0, 3) + ':', err.filename);
	});
});

asset.configure('development', function() {
	//Put your development-specific config here...
});
app.use(asset.middleware);
```

## API

### `asset.register(extension, fn)`

Register a handler for the given file `extension`. `fn` can manipulate the body of the file
and output the contents back to static-asset. `fn` should be of the form: `function (body, filename, cb)`
with `cb` of the form `function (err, new_body)`. You can also pass an array of extensions as in
`asset.register(['css', 'styl'], function() {...});`

### `asset.output(fn)`

Register a handler to deploy the static assets. `fn` is of the form: `function (body, filename, cb)`
with `cb` of the form `function (err)`

static-asset comes with many built-in output functions for your convenience:
	* Deploy the assets to a local directory? Use `asset.output.local`
		* Assumes directory structure above.
		* Caution: May overwrite all contents of /public/assets
	* Deploy the assets to S3? Use `asset.output.s3(opts)`

By default, static-asset will use `asset.output.local` in production and development environments.

Example:

```javascript
asset.configure('production', function() {
	asset.output(asset.output.s3({
		'key': 'my_key',
		'secret': 'my_secret_key',
		'bucket': 'my_bucket',
		'path': ... //optional path prepended to filename
	}));
}
asset.configure('development', function() {
	//Deploy to /public/assets
	asset.output(asset.output.local);
});
```

### `asset.deploy()`

Compiles and deploys all static assets according to the options specified.

### `asset.set(key, value)`

Convenience function to store a key-value pair for later use.

### `asset.get(key, value)`

Convenience function to retrieve a key-value pair that was stored using `set()`.

### `asset.version(fn)`

`fn` allows static-asset to determine the version number of an asset. `fn` must be of the form:
`function(body, filename, cb)` with `cb` of the form `function(err, version_number)`.

This allows static-asset to implement strong caching of assets using URL fingerprinting. By default,
the version number of an asset is the UNIX timestamp of the file's last modification date.